# ブラウザ上でキャッシュ対策を確認する方法

キャッシュ対策が設定されているかどうか、
実際のサイトの検証ツールからネットワークタブを開いて確認する。
その際の確認ポイントをメモしておく。

## レスポンスヘッダー
サーバーからブラウザに送られる情報。
ページが開いたとき、ブラウザがサーバーにリクエストを送ると、
サーバはデータ（HTML、CSS、JSなど）を返す。
その際に、「このデータはいつ作成されたのか？」「キャッシュの期間はどれくらいか？」などの情報が含まれている。

## リクエストヘッダー
ブラウザからサーバーに送る情報。
ページを開くために必要な情報をサーバーにリクエストする。
その際に、「どのようなブラウザを使用しているか？」「どのキャッシュのデータを持っているか？】などの情報を含めている。

## ETag（エタグ）
サーバーがファイルごとに割り当てている「指紋（識別子）」のようなもの。
ブラウザはEtagを保存し、次に同じファイルをリクエストするとき、「このEtagのファイルは最新？」と、サーバーに問い合わせる。

### 初回アクセス（キャッシュなし）
ブラウザ：index.htmlをください。
サーバー：はい、index.htmk（Etag:123）です！

### 再アクセス（キャッシュあり）
ブラウザ：Etag:123のindex.htmlを持っているけど、変更はあった？
- 変更なし
サーバー：変わっていないので、キャッシュを使ってね！（HTTP 304 Not Modified）
- 変更あり
サーバー：変わっているので、新しいファイルを送るね！（Etag:abc）

## Last-Modified（最終更新日）
ファイルが最後の更新された日付。
ブラウザは`If-Modified-Since`（この日付以降に更新されたら、新しいデータをください）というリクエストをサーバーに送る。

### 初回アクセス
サーバー：このファイルの最終更新日は`Last-Modified: Mon, 24 Feb 2025 12:00:00 GMT`です。

### 再アクセス
ブラウザ：このファイルの最終更新日は`If-Modified-Since: Mon, 24 Feb 2025 12:00:00 GMT`だけど、この日付は更新されてる？
- 更新なし
サーバー：更新されてないので、キャッシュを使ってね！（HTTP 304 Not Modified）
- 更新あり
サーバー：更新されていたので、新しいファイルを送るね！

## Cache-Control（キャッシュの制御）
キャッシュの期間を決める設定。

- `Cache-Control: max-age=3600` → 3600秒（1時間）キャッシュしてOK！
- `Cache-Control: max-age=28800` → 28800秒（8時間）キャッシュしてOK！
- `Cache-Control: no-cache` → キャッシュはするけど、必ずサーバーに更新チェックをして！
- `Cache-Control: no-store` → キャッシュを一切しないで欲しい！
- `Cache-Control: private` → このキャッシュはユーザー専用（ログイン情報など）
- `Cache-Control: public` → 全員がこのキャッシュを使える（CSSや画像など）